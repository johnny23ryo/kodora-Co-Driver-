<div class="min-h-screen flex items-center justify-center bg-customGreen p-8">
  <div class="w-full max-w-7xl">

    <!-- ã‚°ãƒ¼ã‚°ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º -->
    <div id="post_index_map" style="height: 600px;" class= "rounded-3xl"></div>

    <script>
      function initIndexMap() {
        if (document.getElementById("post_index_map")) {
          const mapElement = document.getElementById('post_index_map');
          const mapOptions = {
            center: { lat: 35.6803997, lng: 139.7690174 },
            zoom: 6
          };

          const map = new google.maps.Map(mapElement, mapOptions);

          <% Post.all.each do |post| %>
            (function() {
              const marker = new google.maps.Marker({
                position: { lat: <%= post.latitude %>, lng: <%= post.longitude %> },
                map: map,
                title: '<%= j post.title %>'
              });

              let imageTag = '';
              <% if post.post_image.present? %>
                imageTag = `<img src="<%= post.post_image.url %>" alt="ç”»åƒ" class="w-full h-48 object-cover">`;
              <% else %>
                imageTag = `<img src="<%= asset_path('default.png') %>" alt="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒ" class="w-full h-48 object-cover">`;
              <% end %>

              const infowindow = new google.maps.InfoWindow({
                content: `<div class="flex items-center">
                            <div class="w-1/2">
                              ${imageTag}
                            </div>
                            <div class="w-1/2 p-4 text-center">
                              <h2 class="font-bold text-base md:text-xl"><%= j post.title %></h2>
                              <p class="text-gray-700 my-6 font-bold text-base md:text-xl"><%= j post.address %></p>
                              <p><a href='<%= post_path(post) %>' class="text-yellow-500 hover:underline font-bold text-base md:text-xl">è©³ç´°ã‚’è¦‹ã‚‹</a></p>
                            </div>
                          </div>`
              });

              marker.addListener('click', function() {
                infowindow.open(map, marker);
              });
            })();
          <% end %>
          }
        }
    </script>


    <!-- ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆ -->
    <div class="row mb-4">
      <div class="col-12">
        <h1 class = "font-bold text-center text-customRed my-6 text-5xl">ğŸ”¥ğŸ”¥PICKUP!!ğŸ”¥ğŸ”¥</h1>
        <div class="row">
          <% if @pick_up_posts.present? %>
            <div class="grid grid-cols-1 sm:grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-6 mt-8">
              <% @pick_up_posts.each do |post| %>
                <div class="bg-white px-4 py-4 mb-4 text-center rounded-3xl">
                  <% if post.post_image.present? %>
                    <img src="<%= post.post_image.url %>" alt="ç”»åƒ" class="mt-4 w-full h-64 object-cover rounded-3xl">
                  <% else %>
                    <img src="<%= asset_path('default.png') %>" alt="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒ" class="my-4 w-full h-64 object-cover rounded-3xl">
                  <% end %>
                  <% if post.user %>
                    <p class="text-2xl"><strong>æŠ•ç¨¿è€…:</strong> <br> <%= post.user.name %></p>
                  <% else %>
                    <p class="text-2xl"><strong>æŠ•ç¨¿è€…:</strong> <br>æœªãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼</p>
                  <% end %>
                  <p class="text-2xl mb-4"><strong>ã‚¤ãƒ™ãƒ³ãƒˆå:</strong> <br> <%= post.title %></p>
                  <%= link_to 'è©³ç´°ã‚’è¦‹ã‚‹', post_path(post), class: "text-orange-500 hover:text-red-700 text-xl font-bold my-4 underline" %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- æŠ•ç¨¿ä¸€è¦§-->
    <h1 class="font-bold text-center text-customWhite my-6 text-4xl">æŠ•ç¨¿ä¸€è¦§</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8 text-center">
      <% @posts.each do |post| %>
        <div class="bg-white px-4 py-4 mb-4 rounded-3xl">
          <% if post.post_image.present? %>
            <img src="<%= post.post_image.url %>" alt="ç”»åƒ" class="mt-4 w-full h-64 object-cover rounded-3xl">
          <% else %>
            <img src="<%= asset_path('default.png') %>" alt="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒ" class="my-4 w-full h-64 object-cover rounded-3xl">
          <% end %>
          <% if post.user %>
            <p class="text-2xl"><strong>æŠ•ç¨¿è€…:</strong> <br> <%= post.user.name %></p>
          <% else %>
            <p class="text-2xl"><strong>æŠ•ç¨¿è€…:</strong> <br>æœªãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼</p>
          <% end %>
           <p class="text-2xl mb-4"><strong>ã‚¤ãƒ™ãƒ³ãƒˆå:</strong> <br> <%= post.title %></p>
          <%= link_to 'è©³ç´°ã‚’è¦‹ã‚‹', post_path(post), class: "text-orange-500 hover:text-red-700 text-xl font-bold mt-4 underline", data: { turbo: false } %>
        </div>
      <% end %>
    </div>
    <div class="mt-6">
      <%= paginate @posts %>
    </div>
  </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initIndexMap" async defer></script>
